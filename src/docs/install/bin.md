---
title: 启动脚本部署
icon: code
order: 1
date: 2025-06-04
---

::: tip
部署方式见[快速上手-部署安装](../../quick-start/install.md)
本节不再重复讲解
:::

## 启动脚本功能

#### \[0]: 下载并启动饥荒管理平台

1. 清理可能存在的旧饥荒管理平台程序

2. 启动脚本会检查`jq`和`strings`命令，如果发现命令缺失，会自动安装

3. 接下来会获取最新版本的饥荒管理平台下载地址和对应文件的`sha-256`校验值

4. 提示用户选择加速节点，默认会提供3个节点供用户选择

由于饥荒管理平台安装包托管在`Github`上，国内访问受限，需要加速

::: warning
加速节点可能会失效，如果失效请自行修改加速节点
:::

最后一个选项为不加速直接下载

5. 下载饥荒管理平台安装包，并校验

6. 解压安装包并赋予执行权限

7. 清理下载产生的临时文件

8. 查询当前设置的端口是否被占用

9. 检查`glibc`版本，如果版本不符合要求，则会更新`glibc`(仅限ubuntu系统)

10. 启动饥荒管理平台

#### \[1]: 启动饥荒管理平台

启动饥荒管理平台主程序

#### \[2]: 关闭饥荒管理平台

关闭饥荒管理平台主程序

#### \[3]: 重启饥荒管理平台

1. 关闭饥荒管理平台主程序

2. 启动饥荒管理平台主程序

#### \[4]: 更新饥荒管理平台

1. 自动检查最新的饥荒管理平台版本号

2. 获取当前运行的饥荒管理平台版本号

3. 如果发现有更新的版本，则执行：
-  \[2]: 关闭饥荒管理平台
-  \[0]: 下载并启动饥荒管理平台

#### \[5]: 强制更新饥荒管理平台

直接执行：
-  \[2]: 关闭饥荒管理平台
-  \[0]: 下载并启动饥荒管理平台

#### \[6]: 更新run.sh启动脚本

1. 提示用户选择加速节点

2. 保存脚本中可配置的变量

3. 下载最新版本的`run.sh`脚本

4. 将保存的变量写入新下载的脚本中

5. 重启启动脚本

#### \[7]: 设置虚拟内存

为当前系统设置虚拟内存，虚拟内存的大小取决于可配置变量`SWAPSIZE`，脚本会自动创建swap分区并挂载，写入`/etc/fstab`文件实现自动挂载，修改虚拟内存相关的内核参数并持久化保存

#### \[8]: 设置开机自启

向当前用户的crontab中写入：

``` shell
@reboot /bin/bash -c 'source /etc/profile && cd /root && echo 1 | /root/run.sh'
```

以实现开机自启

#### \[9]: 退出脚本

退出当前脚本

## 补充说明

run.sh脚本每次启动会对自身完整性进行校验，如果出现红色闪烁字符，表示启动脚本已被篡改，请重新创建